<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pro Bouncing Balls - Fizik Simülasyonu</title>
    <style>
        :root {
            --bg-color: #0f172a;
            --panel-bg: #1e293b;
            --accent-color: #38bdf8;
            --text-color: #f1f5f9;
        }

        body {
            margin: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            flex-direction: row;
            height: 100vh;
            overflow: hidden;
        }

        /* Sol Panel - Kontroller */
        #sidebar {
            width: 350px;
            background-color: var(--panel-bg);
            padding: 20px;
            overflow-y: auto;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        h2 {
            margin-top: 0;
            color: var(--accent-color);
            font-size: 1.2rem;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
            padding-bottom: 15px;
            border-bottom: 1px solid #334155;
        }

        label {
            font-size: 0.85rem;
            font-weight: 600;
        }

        input[type="number"],
        input[type="color"],
        button {
            background: #334155;
            border: 1px solid #475569;
            color: white;
            padding: 8px;
            border-radius: 4px;
            outline: none;
        }

        button {
            background: var(--accent-color);
            color: var(--bg-color);
            font-weight: bold;
            cursor: pointer;
            transition: opacity 0.2s;
        }

        button:hover {
            opacity: 0.9;
        }

        /* Sağ Panel - Canvas */
        #canvasContainer {
            flex-grow: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        canvas {
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            max-width: 95%;
            max-height: 95%;
        }

        #ballList {
            margin-top: 10px;
            font-size: 0.8rem;
        }

        .ball-item {
            background: #334155;
            padding: 8px;
            margin-bottom: 5px;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* Switch stili */
        .switch {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }
    </style>
</head>

<body>

    <div id="sidebar">
        <h2>Ayarlar</h2>

        <div class="control-group">
            <label>Varsayılan Top Boyutu</label>
            <input type="number" id="ballSize" value="15">
            <button id="addBallButton">Yeni Top Ekle</button>
        </div>

        <div class="control-group">
            <label>Çember Ayarları</label>
            <div style="display:flex; gap:5px;">
                <input type="color" id="circleColor" value="#38bdf8" style="width:40px">
                <input type="number" id="circleGap" value="40" placeholder="Mesafe">
            </div>
            <button id="addCircleButton">Çember Ekle</button>
            <button id="removeCircleButton" style="background:#ef4444">Son Çemberi Sil</button>
        </div>

        <div class="control-group">
            <label class="switch">
                <input type="checkbox" id="circleShrinkOnHit"> Çarpınca Küçült
            </label>
            <label>Küçülme Miktarı</label>
            <input type="number" id="shrinkAmount" value="5">
            <label class="switch">
                <input type="checkbox" id="addBallOnCircleHit"> Çarpınca Top Ekle
            </label>
            <label class="switch">
                <input type="checkbox" id="trailEffect" checked> İz Efekti (Motion Trail)
            </label>
        </div>

        <div id="ballList">
            <strong>Aktif Toplar</strong>
            <div id="ballItemsContainer"></div>
        </div>
    </div>

    <div id="canvasContainer">
        <canvas id="gameCanvas"></canvas>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const ballItemsContainer = document.getElementById('ballItemsContainer');

        // Ayarlar
        let width, height, center;
        const gravity = 0.25;
        const friction = 0.99; // Hava direnci
        let balls = [];
        let circles = [];
        let ballIdCounter = 0;

        function init() {
            width = 800;
            height = 800;
            canvas.width = width;
            canvas.height = height;
            center = { x: width / 2, y: height / 2 };

            // İlk çember
            circles.push({ radius: 300, color: '#38bdf8' });
            addBall();
        }

        class Ball {
            constructor(x, y, radius, color, minSpeed, maxSpeed) {
                this.id = ballIdCounter++;
                this.x = x;
                this.y = y;
                this.radius = radius;
                this.color = color;
                this.dx = (Math.random() - 0.5) * 10;
                this.dy = (Math.random() - 0.5) * 10;
                this.minSpeed = minSpeed;
                this.maxSpeed = maxSpeed;
                this.history = []; // İz efekti için koordinatlar
                this.colliding = false;
            }

            draw() {
                // İz Çizimi
                if (document.getElementById('trailEffect').checked) {
                    ctx.beginPath();
                    ctx.lineWidth = 2;
                    ctx.strokeStyle = this.color + "44"; // Transparan iz
                    for (let i = 0; i < this.history.length; i++) {
                        const pos = this.history[i];
                        ctx.lineTo(pos.x, pos.y);
                    }
                    ctx.stroke();
                }

                // Top Çizimi
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.fillStyle = this.color;
                ctx.shadowBlur = 15;
                ctx.shadowColor = this.color;
                ctx.fill();
                ctx.closePath();
                ctx.shadowBlur = 0; // Diğer çizimleri etkilememesi için
            }

            update(activeCircle) {
                // İzleri kaydet
                this.history.push({ x: this.x, y: this.y });
                if (this.history.length > 15) this.history.shift();

                // Fizik
                this.dy += gravity;
                this.x += this.dx;
                this.y += this.dy;

                const dx = this.x - center.x;
                const dy = this.y - center.y;
                const distance = Math.sqrt(dx * dx + dy * dy);

                // Çember Çarpışma Kontrolü
                if (distance + this.radius >= activeCircle.radius) {
                    const nx = dx / distance;
                    const ny = dy / distance;

                    // Yansıma vektörü
                    const dot = this.dx * nx + this.dy * ny;
                    this.dx = (this.dx - 2 * dot * nx) * 1.02; // Her çarpmada %2 hızlanma
                    this.dy = (this.dy - 2 * dot * ny) * 1.02;

                    // Pozisyonu sınırda tut (içeri kaçmasın)
                    const overlap = (distance + this.radius) - activeCircle.radius;
                    this.x -= overlap * nx;
                    this.y -= overlap * ny;

                    if (!this.colliding) {
                        this.onCollision(activeCircle);
                        this.colliding = true;
                    }
                } else {
                    this.colliding = false;
                }
            }

            onCollision(activeCircle) {
                if (document.getElementById('circleShrinkOnHit').checked) {
                    const amount = parseFloat(document.getElementById('shrinkAmount').value) || 0;
                    if (activeCircle.radius > 50) activeCircle.radius -= amount;
                }
                if (document.getElementById('addBallOnCircleHit').checked && balls.length < 20) {
                    addBall(this.x, this.y);
                }
            }
        }

        function addBall(x = center.x, y = center.y) {
            const size = parseFloat(document.getElementById('ballSize').value) || 15;
            const color = `hsl(${Math.random() * 360}, 70%, 60%)`;
            const ball = new Ball(x, y, size, color, 5, 25);
            balls.push(ball);
            updateBallListUI();
        }

        function updateBallListUI() {
            ballItemsContainer.innerHTML = '';
            balls.forEach(b => {
                const el = document.createElement('div');
                el.className = 'ball-item';
                el.innerHTML = `
          <span style="color:${b.color}">● Top #${b.id}</span>
          <button onclick="removeBall(${b.id})" style="background:transparent; color:#ef4444; border:none; cursor:pointer">Sil</button>
        `;
                ballItemsContainer.appendChild(el);
            });
        }

        window.removeBall = (id) => {
            balls = balls.filter(b => b.id !== id);
            updateBallListUI();
        };

        function animate() {
            // Arka planı hafif transparan temizle (Motion blur etkisi için opsiyonel)
            ctx.fillStyle = '#0f172a';
            ctx.fillRect(0, 0, width, height);

            const activeCircle = circles[circles.length - 1];

            // Çemberleri Çiz
            circles.forEach(c => {
                ctx.beginPath();
                ctx.arc(center.x, center.y, c.radius, 0, Math.PI * 2);
                ctx.strokeStyle = c.color;
                ctx.lineWidth = (c === activeCircle) ? 4 : 1;
                ctx.stroke();
            });

            // Topları Güncelle ve Çiz
            balls.forEach(ball => {
                ball.update(activeCircle);
                ball.draw();
            });

            requestAnimationFrame(animate);
        }

        // Event Listeners
        document.getElementById('addBallButton').addEventListener('click', () => addBall());
        document.getElementById('addCircleButton').addEventListener('click', () => {
            const gap = parseFloat(document.getElementById('circleGap').value) || 30;
            const lastR = circles[circles.length - 1].radius;
            circles.push({ radius: lastR + gap, color: document.getElementById('circleColor').value });
        });
        document.getElementById('removeCircleButton').addEventListener('click', () => {
            if (circles.length > 1) circles.pop();
        });

        init();
        animate();
    </script>
</body>

</html>