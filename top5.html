<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Bouncing Balls & Çoklu Çemberler</title>
  <style>
    body {
      margin: 0;
      background-color: #fff;
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    canvas {
      background-color: #fff;
      border: 1px solid #ccc;
      margin-top: 10px;
    }
    #controls {
      margin-top: 10px;
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      justify-content: center;
      align-items: center;
    }
    #controls > div {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    label {
      font-weight: bold;
    }
    #ballList {
      margin-top: 15px;
      width: 800px;
    }
    .ballItem {
      display: flex;
      align-items: center;
      justify-content: space-between;
      border: 1px solid #ddd;
      padding: 5px 10px;
      margin-bottom: 5px;
      background-color: #f9f9f9;
    }
    .ballInfo {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .colorBox {
      width: 20px;
      height: 20px;
      border: 1px solid #000;
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas" width="800" height="600"></canvas>
  
  <!-- Kontroller: Ball ve Çember Ayarları -->
  <div id="controls">
    <!-- Top ile ilgili ayarlar -->
    <div id="ballControls">
      <div>
        <label for="minSpeed">Min Hız:</label>
        <input type="number" id="minSpeed" value="5" min="1">
      </div>
      <div>
        <label for="maxSpeed">Max Hız:</label>
        <input type="number" id="maxSpeed" value="20" min="1">
      </div>
      <div>
        <button id="addBallButton">Top Ekle</button>
      </div>
    </div>
    <!-- Çember ile ilgili ayarlar -->
    <div id="circleControls">
      <div>
        <label for="circleColor">Çember Rengi:</label>
        <input type="color" id="circleColor" value="#0000FF">
      </div>
      <div>
        <label for="circleGap">Yeni Çember Mesafesi:</label>
        <input type="number" id="circleGap" value="50" min="1">
      </div>
      <div>
        <button id="addCircleButton">Çember Ekle</button>
        <button id="removeCircleButton">Çember Sil</button>
      </div>
    </div>
  </div>
  
  <!-- Eklenen topların bilgileri -->
  <div id="ballList"></div>
  
  <script>
    // Canvas ve temel ayarlar
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const WIDTH = canvas.width;
    const HEIGHT = canvas.height;
    const center = { x: WIDTH / 2, y: HEIGHT / 2 };

    // Fiziksel parametreler
    const gravity = 0.5;
    const speedChangeMin = 0.8;
    const speedChangeMax = 1.8;
    const defaultBallSpeed = 5;
    const ballRadius = 20;
    
    // Toplar için dizi ve benzersiz id sayacı
    let balls = [];
    let ballIdCounter = 0;
    
    // Çemberler için dizi: hepsi merkezde, yarıçapları artarak (ilk çember default olarak)
    let circles = [];
    const defaultCircleRadius = 250;
    // İlk çemberin rengi, kontrollerden alınıyor
    let initialCircleColor = document.getElementById('circleColor').value;
    circles.push({ radius: defaultCircleRadius, color: initialCircleColor });
    
    // Kontrol paneli değişkenleri
    let minSpeed = parseFloat(document.getElementById('minSpeed').value);
    let maxSpeed = parseFloat(document.getElementById('maxSpeed').value);
    
    // Rastgele renk üretimi (toplar için)
    function getRandomColor() {
      let letters = '0123456789ABCDEF';
      let color = '#';
      for (let i = 0; i < 6; i++) {
        color += letters[Math.floor(Math.random() * 16)];
      }
      return color;
    }
    
    // Yeni top ekleme: merkezden, rastgele yön ve renk ile
    function addBall() {
      const angle = Math.random() * 2 * Math.PI;
      const dx = defaultBallSpeed * Math.cos(angle);
      const dy = defaultBallSpeed * Math.sin(angle);
      const color = getRandomColor();
      const ball = {
        id: ballIdCounter++,
        x: center.x,
        y: center.y,
        dx: dx,
        dy: dy,
        radius: ballRadius,
        color: color
      };
      balls.push(ball);
      updateBallList();
    }
    
    // Topu silme (liste güncelleme)
    function removeBall(ballId) {
      balls = balls.filter(ball => ball.id !== ballId);
      updateBallList();
    }
    
    // Eklenen topların bilgilerini listele
    function updateBallList() {
      const ballListDiv = document.getElementById('ballList');
      ballListDiv.innerHTML = '';
      balls.forEach(ball => {
        const ballDiv = document.createElement('div');
        ballDiv.className = "ballItem";
        
        const infoDiv = document.createElement('div');
        infoDiv.className = "ballInfo";
        const colorBox = document.createElement('div');
        colorBox.className = "colorBox";
        colorBox.style.backgroundColor = ball.color;
        const infoText = document.createElement('span');
        infoText.textContent = `Top ID: ${ball.id}`;
        
        infoDiv.appendChild(colorBox);
        infoDiv.appendChild(infoText);
        
        const deleteBtn = document.createElement('button');
        deleteBtn.textContent = "Sil";
        deleteBtn.addEventListener('click', () => removeBall(ball.id));
        
        ballDiv.appendChild(infoDiv);
        ballDiv.appendChild(deleteBtn);
        ballListDiv.appendChild(ballDiv);
      });
    }
    
    // Çember ekleme: girilen mesafe, mevcut en dıştaki çembere eklenecek
    function addCircle() {
      const gap = parseFloat(document.getElementById('circleGap').value);
      if (isNaN(gap) || gap <= 0) return;
      const lastCircle = circles[circles.length - 1];
      // Yeni çemberin yarıçapı, öncekinin yarıçapına gap eklenerek hesaplanır
      const newRadius = lastCircle.radius + gap;
      // Yeni çemberin rengi, circleColor inputunun şimdiki değeri
      const newColor = document.getElementById('circleColor').value;
      circles.push({ radius: newRadius, color: newColor });
    }
    
    // Çember silme: en dıştaki çemberi (ancak en az 1 çember kalacak şekilde) siler
    function removeCircle() {
      if (circles.length > 1) {
        circles.pop();
      }
    }
    
    // Event listener'lar
    document.getElementById('addBallButton').addEventListener('click', addBall);
    document.getElementById('minSpeed').addEventListener('change', (e) => {
      minSpeed = parseFloat(e.target.value);
    });
    document.getElementById('maxSpeed').addEventListener('change', (e) => {
      maxSpeed = parseFloat(e.target.value);
    });
    document.getElementById('addCircleButton').addEventListener('click', addCircle);
    document.getElementById('removeCircleButton').addEventListener('click', removeCircle);
    // Çember rengi değiştirildiğinde, aktif (en dıştaki) çemberin rengini güncelle
    document.getElementById('circleColor').addEventListener('change', (e) => {
      const newColor = e.target.value;
      circles[circles.length - 1].color = newColor;
    });
    
    // Ana animasyon döngüsü
    function update() {
      // Aktif çember: en dıştaki çember, ball collision için kullanılıyor
      const activeCircle = circles[circles.length - 1];
      
      // Toplar için: yerçekimi, pozisyon güncelleme, çarpışma (aktif çember sınırı)
      balls.forEach(ball => {
        ball.dy += gravity;
        ball.x += ball.dx;
        ball.y += ball.dy;
        
        // Merkezden topun uzaklığı
        const dx = ball.x - center.x;
        const dy = ball.y - center.y;
        const distance = Math.sqrt(dx * dx + dy * dy);
        
        // Aktif çember sınırı kontrolü: top dışarı çıkmamalı
        if (distance + ball.radius >= activeCircle.radius) {
          const nx = dx / distance;
          const ny = dy / distance;
          const dot = ball.dx * nx + ball.dy * ny;
          ball.dx = ball.dx - 2 * dot * nx;
          ball.dy = ball.dy - 2 * dot * ny;
          
          // Topu çakışmayı giderecek şekilde geri taşı
          const overlap = (distance + ball.radius) - activeCircle.radius;
          ball.x -= overlap * nx;
          ball.y -= overlap * ny;
          
          // Rastgele hız çarpanı
          const speedChange = speedChangeMin + Math.random() * (speedChangeMax - speedChangeMin);
          ball.dx *= speedChange;
          ball.dy *= speedChange;
          
          // Hız sınırları
          const currentSpeed = Math.sqrt(ball.dx * ball.dx + ball.dy * ball.dy);
          if (currentSpeed < minSpeed) {
            const boost = minSpeed / currentSpeed;
            ball.dx *= boost;
            ball.dy *= boost;
          } else if (currentSpeed > maxSpeed) {
            const reduction = maxSpeed / currentSpeed;
            ball.dx *= reduction;
            ball.dy *= reduction;
          }
        }
      });
      
      // Toplar arası çarpışma (önceki versiyondaki gibi elastik çarpışma)
      for (let i = 0; i < balls.length; i++) {
        for (let j = i + 1; j < balls.length; j++) {
          const ball1 = balls[i];
          const ball2 = balls[j];
          const dx = ball2.x - ball1.x;
          const dy = ball2.y - ball1.y;
          const dist = Math.sqrt(dx * dx + dy * dy);
          if (dist < ball1.radius + ball2.radius) {
            const nx = dx / dist;
            const ny = dy / dist;
            const overlap = (ball1.radius + ball2.radius - dist);
            ball1.x -= nx * overlap / 2;
            ball1.y -= ny * overlap / 2;
            ball2.x += nx * overlap / 2;
            ball2.y += ny * overlap / 2;
            
            const relVelX = ball1.dx - ball2.dx;
            const relVelY = ball1.dy - ball2.dy;
            const dot = relVelX * nx + relVelY * ny;
            if (dot < 0) {
              ball1.dx -= dot * nx;
              ball1.dy -= dot * ny;
              ball2.dx += dot * nx;
              ball2.dy += dot * ny;
            }
          }
        }
      }
      
      // Çizim
      ctx.clearRect(0, 0, WIDTH, HEIGHT);
      
      // Tüm çemberleri çiz (içten dışa)
      circles.forEach(circle => {
        ctx.beginPath();
        ctx.arc(center.x, center.y, circle.radius, 0, Math.PI * 2);
        ctx.strokeStyle = circle.color;
        ctx.lineWidth = 2;
        ctx.stroke();
        ctx.closePath();
      });
      
      // Tüm topları çiz
      balls.forEach(ball => {
        ctx.beginPath();
        ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
        ctx.fillStyle = ball.color;
        ctx.fill();
        ctx.closePath();
      });
      
      requestAnimationFrame(update);
    }
    
    requestAnimationFrame(update);
  </script>
</body>
</html>
